---
title: "3.2.2. 动态表容量与驱逐"
anchor: "3.2.2_Dynamic_Table_Capacity_and_Eviction"
weight: 3220
rank: "h3"
---

动态表的容量是由编码器设置的，它的意义是动态表尺寸的上限。
动态表的初始容量为零。
编码器想要使用动态表，就要发送一条容量值非零的“设置动态表容量”（Set Dynamic Table Capacity，详见[第4.3.1章](#4.3.1_Set_Dynamic_Table_Capacity)）指令。

在向动态表添加条目前，先要从动态表的末尾开始驱逐条目，直到动态表的尺寸小于等于动态表容量与新条目尺寸的差。
除非某条目是可驱逐的，否则编码器{{< req_level MUST_NOT >}}驱逐它；详见[第2.1.1章](#2.1.1_Limits_on_Dynamic_Table_Insertions)。
随后，就可以向动态表添加新条目。
如果编码器试图添加一条尺寸大于动态表容量的条目，那么会产生错误；解码器{{< req_level MUST >}}将这种情况视作类型为`QPACK_ENCODER_STREAM_ERROR`的连接错误。

正在向动态表添加的新条目可以引用动态表中即将被驱逐的条目。
如果被引用的条目在插入新条目前就被已经驱逐，那么实现要注意确保被引用的名称和值仍存在于表中。

一旦动态表的容量被编码器缩减（详见[第4.3.1章]（）），那么就要从动态表的末尾开始驱逐条目，直到动态表的尺寸小于等于新的表容量。
通过将容量设置为`0`，随后恢复容量的方式，可以利用这项机制来完全清除动态表中的条目。
