---
title: "2.1.2. 阻塞流"
anchor: "2.1.2_Blocked_Streams"
weight: 212
rank: "h3"
---


因为QUIC并不确保不同流之间的数据有序传输，解码器可能收到引用一个其尚未收到的动态表条目的表示。

每个编码的字段块包含一个“必要插入计数”（Required Insert Count，详见[第4.5.1章]()），能够解码字段块的最低可能插入计数值。
对于一个引用了动态表编码的字段块，其必要插入计数大于所有被引用的动态表条目中最大绝对索引。
对于一个没有引用动态表的字段块，其必要插入计数是零。

当解码器收到一个必要插入计数大于解码器的插入计数的编码字段块时，流不能被立即处理，并被认为是“被阻塞的”，详见[第2.2.1]()。

解码器使用`SETTINGS_QPACK_BLOCKED_STREAMS`（QPACK阻塞流数目）设置指定可以被阻塞的流数目的上限，详见[第5章]()。
编码器{{< req_level MUST >}}在所有时间都将可被阻塞的流的数目限制在`SETTINGS_QPACK_BLOCKED_STREAMS`值内。
如果编码器遇到被阻塞的流超过其承诺支持的数目时，其{{< req_level MUST >}}将之视为一个`QPACK_DECOMPRESSION_FAILED`类型的连接错误。

编码器可以决定是否冒险让某个流变成阻塞状态。
如果`SETTINGS_QPACK_BLOCKED_STREAMS`的值允许，通常可以通过引用正在传输中的动态表条目提升压缩率，但是如果出现丢包或乱序，解码器侧的流可能变成阻塞状态。
编码器可以通过只引用已经被确认的动态表条目规避阻塞风险，但是这可能意味着使用明文。
由于明文会使得编码字段块更大，可能导致编码器被拥塞或流量控制限制所阻塞。
