---
title: "2.1.1. 动态表插入限制"
anchor: "2.1.1_Limits_on_Dynamic_Table_Insertions"
weight: 211
rank: "h3"
---

若表中存在不能被驱逐的条目，则将条目插入动态表可能不会成功。

动态表条目在插入后不能立即驱逐，即使其尚未被引用。
一旦动态表条目的插入得到确认，且没有外部未被确认的表示引用到该条目，则该条目就变成可以被驱逐的了。
注意，在编码器流上的引用从不妨碍条目的驱逐，因为会确保这些引用在指令驱逐条目之前得到处理。

若动态表在不驱逐其他条目的前提下没有足够空间留给一条新的条目，且将被驱逐的条目是不可驱逐的，那么编码器{{< req_level MUST_NOT >}}插入该条目到动态表中（包括复制已经存在的条目）。
为了避免这种情况，
使用了动态表的编码器必须对被每个字段行块引用的每条动态表条目保持追踪，直到这些表示被解码器确认，详见[第4.4.1章]()。

#### 2.1.1.1. 避免非法插入

为了确保编码器不被阻止添加新的条目，编码器可以避免引用接近被驱逐的条目。
相较于引用这样的条目，编码器可以发射复制指令（详见[第4.3.4章]()）并转而引用该复制条目。

确认哪些条目最接近被引用所驱逐，取决于编码器的决定。
一种启发式方法是把一个动态表中的固定数量的空间锁定：不论未被使用的空间还是可以通过发射非阻塞条目而重用的空间。
为了达到这个目标，编码器可以维持一个排解索引，
它是将发射索引的动态表中最小的绝对索引（详见[第3.2.4章]()）。
随着新的条目的插入，编码器增加排解索引以维持其不引用的表中的块。
对那些绝对索引小于排解索引的条目，如果编码器没有对其创建新的引用，则其未确认的引用的数目将最终降为零，使之最终被驱逐。

TODO：图1，排解动态表条目

